---
phase: 06-sample-scene-and-integration
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - Packages/com.google.ai-embodiment/package.json
  - Packages/com.google.ai-embodiment/Samples~/AyaLiveStream/AyaLiveStream.asmdef
  - Packages/com.google.ai-embodiment/Samples~/AyaLiveStream/UI/AyaPanel.uxml
  - Packages/com.google.ai-embodiment/Samples~/AyaLiveStream/UI/AyaPanel.uss
autonomous: true

must_haves:
  truths:
    - "Package Manager shows 'Aya Live Stream' sample with Import button"
    - "UI layout defines chat log, persona name header, speaking indicator, status label, and push-to-talk button"
    - "Sample scripts can reference AIEmbodiment, Firebase.AI, and Input System types without compile errors"
  artifacts:
    - path: "Packages/com.google.ai-embodiment/package.json"
      provides: "UPM samples array pointing to Samples~/AyaLiveStream"
      contains: "Aya Live Stream"
    - path: "Packages/com.google.ai-embodiment/Samples~/AyaLiveStream/AyaLiveStream.asmdef"
      provides: "Assembly definition with references to package runtime, Firebase.AI, and Input System"
      contains: "com.google.ai-embodiment"
    - path: "Packages/com.google.ai-embodiment/Samples~/AyaLiveStream/UI/AyaPanel.uxml"
      provides: "UI Toolkit layout with named elements for chat log, header, footer, push-to-talk"
      contains: "chat-log"
    - path: "Packages/com.google.ai-embodiment/Samples~/AyaLiveStream/UI/AyaPanel.uss"
      provides: "Dark-themed styling with speaking glow, message classes, push-to-talk button"
      contains: ".msg-aya"
  key_links:
    - from: "package.json"
      to: "Samples~/AyaLiveStream"
      via: "samples array path field"
      pattern: "Samples~/AyaLiveStream"
    - from: "AyaLiveStream.asmdef"
      to: "com.google.ai-embodiment runtime"
      via: "asmdef references array"
      pattern: "com.google.ai-embodiment"
---

<objective>
Create the UPM sample folder structure, assembly definition, package.json sample entry, and UI Toolkit layout/styling assets for the Aya Live Stream sample scene.

Purpose: Establishes the sample folder that developers import via Package Manager and defines the UI layout that the C# scripts will wire up in Plan 02.
Output: Samples~/AyaLiveStream/ folder with asmdef, UXML, USS files and updated package.json.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-sample-scene-and-integration/06-RESEARCH.md

@Packages/com.google.ai-embodiment/package.json
@Packages/com.google.ai-embodiment/Runtime/com.google.ai-embodiment.asmdef
</context>

<tasks>

<task type="auto">
  <name>Task 1: Package config and sample asmdef</name>
  <files>
    Packages/com.google.ai-embodiment/package.json
    Packages/com.google.ai-embodiment/Samples~/AyaLiveStream/AyaLiveStream.asmdef
  </files>
  <action>
1. Update `package.json` to add a `samples` array:
```json
"samples": [
  {
    "displayName": "Aya Live Stream",
    "description": "Full pipeline demo: AI persona with voice, chat log, function calls, and conversational goals.",
    "path": "Samples~/AyaLiveStream"
  }
]
```
Add this as a new top-level field after `keywords`. Keep all existing fields unchanged.

2. Create `Samples~/AyaLiveStream/AyaLiveStream.asmdef`:
```json
{
    "name": "com.google.ai-embodiment.samples.ayalivestream",
    "rootNamespace": "AIEmbodiment.Samples",
    "references": [
        "com.google.ai-embodiment",
        "Firebase.AI",
        "Unity.InputSystem"
    ],
    "includePlatforms": [],
    "excludePlatforms": [],
    "allowUnsafeCode": false,
    "overrideReferences": false,
    "precompiledReferences": [],
    "autoReferenced": true,
    "defineConstraints": [],
    "versionDefines": [],
    "noEngineReferences": false
}
```

The three references are critical (Pitfall 1 and 2 from research):
- `com.google.ai-embodiment`: PersonaSession, AudioCapture, AudioPlayback, all runtime types
- `Firebase.AI`: FunctionDeclaration, Schema, Tool (needed for function registration)
- `Unity.InputSystem`: Keyboard.current for push-to-talk spacebar polling

Create the `Samples~/AyaLiveStream/` directory if it does not exist. The `Samples~/` directory already exists (empty).
  </action>
  <verify>
Confirm `package.json` is valid JSON with `samples` array present. Confirm `AyaLiveStream.asmdef` is valid JSON with all three references. Verify directory structure exists: `Samples~/AyaLiveStream/AyaLiveStream.asmdef`.
  </verify>
  <done>
package.json has samples entry pointing to Samples~/AyaLiveStream. AyaLiveStream.asmdef references com.google.ai-embodiment, Firebase.AI, and Unity.InputSystem. Both files are valid JSON.
  </done>
</task>

<task type="auto">
  <name>Task 2: UI Toolkit UXML layout and USS styling</name>
  <files>
    Packages/com.google.ai-embodiment/Samples~/AyaLiveStream/UI/AyaPanel.uxml
    Packages/com.google.ai-embodiment/Samples~/AyaLiveStream/UI/AyaPanel.uss
  </files>
  <action>
Create `Samples~/AyaLiveStream/UI/` directory.

1. Create `AyaPanel.uxml` -- the UI Toolkit layout for the chat panel. This defines the element names that AyaChatUI.cs will query via `Q<>()` in Plan 02.

Layout structure (top to bottom):
- Root container (`name="root-container"`, `class="root"`) fills the screen
- Header row (`name="header"`, `class="header"`): speaking indicator dot + persona name label
  - Speaking indicator (`name="speaking-indicator"`, `class="indicator"`) -- small circle, toggles glow class
  - Persona name label (`name="persona-name"`, `text="Aya"`, `class="name-label"`)
- Chat log (`name="chat-log"`, `class="chat-log"`) -- ScrollView with vertical auto-scroll, hidden horizontal scroller
  - `vertical-scroller-visibility="Auto"` and `horizontal-scroller-visibility="Hidden"`
- Footer row (`name="footer"`, `class="footer"`): status label + push-to-talk button
  - Status label (`name="status-label"`, `text="Starting up..."`, `class="status"`)
  - Push-to-talk button (`name="ptt-button"`, `text="Hold to Talk"`, `class="ptt-button"`)

Full UXML (use this exactly):
```xml
<ui:UXML xmlns:ui="UnityEngine.UIElements">
    <ui:VisualElement name="root-container" class="root">
        <ui:VisualElement name="header" class="header">
            <ui:VisualElement name="speaking-indicator" class="indicator" />
            <ui:Label name="persona-name" text="Aya" class="name-label" />
        </ui:VisualElement>

        <ui:ScrollView name="chat-log" class="chat-log"
            vertical-scroller-visibility="Auto"
            horizontal-scroller-visibility="Hidden" />

        <ui:VisualElement name="footer" class="footer">
            <ui:Label name="status-label" text="Starting up..." class="status" />
            <ui:Button name="ptt-button" text="Hold to Talk" class="ptt-button" />
        </ui:VisualElement>
    </ui:VisualElement>
</ui:UXML>
```

2. Create `AyaPanel.uss` -- dark-themed styling with live-stream aesthetic.

Key design decisions:
- Dark background (rgb 24,24,32) -- live stream / dark mode feel
- Chat log area: slightly darker (rgb 16,16,24) with rounded corners
- Aya messages: purple-ish (rgb 200,170,255) -- matches her creative personality
- User messages: blue-ish (rgb 170,220,255) -- clearly distinct from Aya
- System messages: muted gray italic (rgb 120,120,140)
- Speaking indicator: gray dot that turns green with border glow when `.indicator--speaking` class is added
- Push-to-talk button: purple-themed with hover/active states
- Name label: bold, purple accent color
- All text elements use `white-space: normal` for word wrapping
- USS does NOT support `box-shadow` -- use `border-color` for speaking glow effect

Full USS (use the styles from research, which are reproduced here):
```css
.root {
    flex-grow: 1;
    background-color: rgb(24, 24, 32);
    padding: 12px;
}

.header {
    flex-direction: row;
    align-items: center;
    margin-bottom: 8px;
}

.indicator {
    width: 12px;
    height: 12px;
    border-radius: 6px;
    background-color: rgb(80, 80, 80);
    margin-right: 8px;
}

.indicator--speaking {
    background-color: rgb(100, 255, 100);
    border-width: 2px;
    border-color: rgb(100, 255, 100);
}

.name-label {
    font-size: 20px;
    color: rgb(220, 180, 255);
    -unity-font-style: bold;
}

.chat-log {
    flex-grow: 1;
    background-color: rgb(16, 16, 24);
    border-radius: 8px;
    padding: 8px;
    margin-bottom: 8px;
}

.msg-aya {
    color: rgb(200, 170, 255);
    margin-bottom: 4px;
    white-space: normal;
}

.msg-user {
    color: rgb(170, 220, 255);
    margin-bottom: 4px;
    white-space: normal;
}

.msg-system {
    color: rgb(120, 120, 140);
    margin-bottom: 4px;
    -unity-font-style: italic;
    white-space: normal;
}

.footer {
    flex-direction: row;
    align-items: center;
    justify-content: space-between;
}

.status {
    color: rgb(140, 140, 160);
    font-size: 12px;
}

.ptt-button {
    background-color: rgb(80, 60, 120);
    color: rgb(255, 255, 255);
    border-radius: 6px;
    padding: 8px 16px;
    font-size: 14px;
    -unity-font-style: bold;
}

.ptt-button:hover {
    background-color: rgb(100, 80, 140);
}

.ptt-button:active {
    background-color: rgb(120, 100, 160);
}
```

IMPORTANT: The element names in the UXML (chat-log, persona-name, speaking-indicator, status-label, ptt-button) are the contract between UXML and C# code. Plan 02's AyaChatUI.cs will use `root.Q<ScrollView>("chat-log")`, `root.Q<Label>("persona-name")`, etc. Do not change these names.
  </action>
  <verify>
Confirm both files exist in `Samples~/AyaLiveStream/UI/`. Verify UXML is valid XML (well-formed). Verify USS contains all required class selectors: `.root`, `.header`, `.indicator`, `.indicator--speaking`, `.name-label`, `.chat-log`, `.msg-aya`, `.msg-user`, `.msg-system`, `.footer`, `.status`, `.ptt-button`, `.ptt-button:hover`, `.ptt-button:active`.
  </verify>
  <done>
AyaPanel.uxml defines the full chat panel layout with named elements (chat-log, persona-name, speaking-indicator, status-label, ptt-button). AyaPanel.uss provides dark-themed styling with speaking glow indicator, distinct message colors for Aya/user/system, and interactive push-to-talk button states.
  </done>
</task>

</tasks>

<verification>
1. `Samples~/AyaLiveStream/` directory exists with AyaLiveStream.asmdef, UI/AyaPanel.uxml, UI/AyaPanel.uss
2. package.json is valid JSON with samples array containing one entry
3. asmdef is valid JSON with all three required assembly references
4. UXML is well-formed XML with all required named elements
5. USS contains all required class selectors including speaking state and message type classes
</verification>

<success_criteria>
- package.json has samples entry for "Aya Live Stream" pointing to Samples~/AyaLiveStream
- AyaLiveStream.asmdef references com.google.ai-embodiment, Firebase.AI, Unity.InputSystem
- AyaPanel.uxml defines: root-container, header, speaking-indicator, persona-name, chat-log (ScrollView), footer, status-label, ptt-button
- AyaPanel.uss defines dark theme with .indicator--speaking glow, .msg-aya/.msg-user/.msg-system colors, .ptt-button interactive states
</success_criteria>

<output>
After completion, create `.planning/phases/06-sample-scene-and-integration/06-01-SUMMARY.md`
</output>
