---
phase: 11.1-queued-response-sample
plan: 02
type: execute
wave: 2
depends_on: ["11.1-01"]
files_modified:
  - Packages/com.google.ai-embodiment/Samples~/QueuedResponseSample/QueuedResponseController.cs
  - Packages/com.google.ai-embodiment/Samples~/QueuedResponseSample/QueuedResponseUI.cs
  - Packages/com.google.ai-embodiment/Samples~/QueuedResponseSample/QueuedResponseSample.asmdef
  - Packages/com.google.ai-embodiment/Samples~/QueuedResponseSample/UI/QueuedResponsePanel.uxml
  - Packages/com.google.ai-embodiment/Samples~/QueuedResponseSample/UI/QueuedResponsePanel.uss
autonomous: false

must_haves:
  truths:
    - "Samples~ directory contains canonical copy of QueuedResponseSample for package distribution"
    - "User holds spacebar to record -- input transcript appears on screen in real time"
    - "AI response audio is buffered in background while user reviews their transcript"
    - "User presses Enter -- queued AI response begins playback immediately"
    - "AI response transcript displays alongside audio playback"
    - "After AI response completes, user can hold spacebar again for next turn"
  artifacts:
    - path: "Packages/com.google.ai-embodiment/Samples~/QueuedResponseSample/QueuedResponseController.cs"
      provides: "Canonical copy of controller for package samples"
    - path: "Packages/com.google.ai-embodiment/Samples~/QueuedResponseSample/QueuedResponseUI.cs"
      provides: "Canonical copy of UI controller for package samples"
    - path: "Packages/com.google.ai-embodiment/Samples~/QueuedResponseSample/QueuedResponseSample.asmdef"
      provides: "Canonical copy of asmdef for package samples"
    - path: "Packages/com.google.ai-embodiment/Samples~/QueuedResponseSample/UI/QueuedResponsePanel.uxml"
      provides: "Canonical copy of UXML layout for package samples"
    - path: "Packages/com.google.ai-embodiment/Samples~/QueuedResponseSample/UI/QueuedResponsePanel.uss"
      provides: "Canonical copy of USS styles for package samples"
  key_links:
    - from: "Packages/com.google.ai-embodiment/Samples~/QueuedResponseSample/"
      to: "Assets/QueuedResponseSample/"
      via: "file copy (cp -r)"
      pattern: "identical file contents"
---

<objective>
Sync the QueuedResponseSample to the package Samples~ directory and perform end-to-end human verification of the complete queued response UX in Unity.

Purpose: The Samples~ directory is the canonical location for package-distributed samples. Human verification confirms the full push-to-talk transcript approval flow works as designed.

Output: Canonical sample files in Samples~ and verified working UX.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/11.1-queued-response-sample/11.1-01-SUMMARY.md

@Assets/QueuedResponseSample/QueuedResponseController.cs
@Assets/QueuedResponseSample/QueuedResponseUI.cs
@Assets/QueuedResponseSample/QueuedResponseSample.asmdef
@Assets/QueuedResponseSample/UI/QueuedResponsePanel.uxml
@Assets/QueuedResponseSample/UI/QueuedResponsePanel.uss
</context>

<tasks>

<task type="auto">
  <name>Task 1: Sync QueuedResponseSample to Samples~ directory</name>
  <files>
    Packages/com.google.ai-embodiment/Samples~/QueuedResponseSample/QueuedResponseController.cs
    Packages/com.google.ai-embodiment/Samples~/QueuedResponseSample/QueuedResponseUI.cs
    Packages/com.google.ai-embodiment/Samples~/QueuedResponseSample/QueuedResponseSample.asmdef
    Packages/com.google.ai-embodiment/Samples~/QueuedResponseSample/UI/QueuedResponsePanel.uxml
    Packages/com.google.ai-embodiment/Samples~/QueuedResponseSample/UI/QueuedResponsePanel.uss
  </files>
  <action>
    Copy the source files (NOT .meta files) from Assets/QueuedResponseSample/ to Packages/com.google.ai-embodiment/Samples~/QueuedResponseSample/.

    Create the directory structure first:
    ```bash
    mkdir -p Packages/com.google.ai-embodiment/Samples~/QueuedResponseSample/UI
    ```

    Copy these files (no .meta files -- Samples~ is not imported by Unity):
    - QueuedResponseController.cs
    - QueuedResponseUI.cs
    - QueuedResponseSample.asmdef
    - UI/QueuedResponsePanel.uxml
    - UI/QueuedResponsePanel.uss

    Verify with diff that copies are identical to source:
    ```bash
    diff Assets/QueuedResponseSample/QueuedResponseController.cs Packages/com.google.ai-embodiment/Samples~/QueuedResponseSample/QueuedResponseController.cs
    ```

    This matches the existing pattern -- Packages/com.google.ai-embodiment/Samples~/AyaLiveStream/ contains the same source files as Assets/AyaLiveStream/ without .meta files.
  </action>
  <verify>
    All 5 files exist in Samples~/QueuedResponseSample/.
    diff confirms all copies are byte-identical to Assets/ originals.
    No .meta files in Samples~ (should only have .cs, .asmdef, .uxml, .uss).
  </verify>
  <done>
    Packages/com.google.ai-embodiment/Samples~/QueuedResponseSample/ contains canonical copies of all 5 source files, matching Assets/QueuedResponseSample/ exactly.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
    Complete QueuedResponseSample: state machine controller with audio buffering, UI Toolkit interface, push-to-talk transcript approval UX.

    The scene needs manual setup in Unity Editor because scene files (.unity) are binary YAML that cannot be reliably authored outside the editor. The setup steps create the scene hierarchy documented in the research.
  </what-built>
  <how-to-verify>
    **Scene Setup (one-time, in Unity Editor):**

    1. Create a new scene: File > New Scene (Basic Built-in)
    2. Save as: Assets/Scenes/QueuedResponseScene.unity

    3. Create GameObjects with these components:
       - **UIDocument** (empty GO):
         - Add UIDocument component
         - Set Source Asset to Assets/QueuedResponseSample/UI/QueuedResponsePanel.uxml
         - Set Panel Settings to the same PanelSettings used by AyaLiveStream (or create default)
         - Add QueuedResponseUI component, wire _uiDocument to the UIDocument on same GO

       - **AISession** (empty GO):
         - Add PersonaSession component
         - Set _config to the existing AyaPersonaConfig asset (Assets/AyaLiveStream/AyaPersonaConfig.asset)
         - Add AudioCapture component
         - Do NOT assign _audioPlayback on PersonaSession (leave null -- this is the key decoupling)

       - **AudioPlayer** (empty GO):
         - Add AudioSource component (PlayOnAwake off, Loop off)
         - Add AudioPlayback component, wire _audioSource to the AudioSource on same GO

       - **QueuedResponseController** (empty GO):
         - Add QueuedResponseController component
         - Wire _session to the PersonaSession on AISession
         - Wire _audioPlayback to the AudioPlayback on AudioPlayer
         - Wire _ui to the QueuedResponseUI on UIDocument

    4. Ensure Main Camera has an AudioListener

    **End-to-End Test:**

    5. Enter Play Mode
    6. Verify status shows "Connecting to AI..." then transitions to "Ready" with "[SPACE] Record" hint
    7. Hold SPACE -- verify:
       - Status changes to "Recording... Release SPACE when done."
       - Indicator turns red
       - Your speech transcript appears in the "You:" area in real time
    8. Release SPACE -- verify:
       - Status changes to "Review your message."
       - Hints show "[ENTER] Send  |  [ESC] Cancel"
       - Your final transcript remains visible
    9. Press ENTER -- verify:
       - AI response audio plays back (should start nearly immediately if AI responded quickly)
       - AI response text appears in the "AI:" area
       - Status shows "AI is responding..."
    10. Wait for response to complete -- verify:
       - Status returns to "Ready" with "[SPACE] Record"
       - Can hold SPACE again for another turn
    11. Test discard: Record something, release SPACE, press ESC -- verify return to Idle with cleared transcripts
  </how-to-verify>
  <resume-signal>Type "approved" if the full flow works, or describe specific issues encountered.</resume-signal>
</task>

</tasks>

<verification>
Samples~ files are identical copies of Assets/ source files (no .meta files in Samples~).
Human verified: spacebar recording, transcript display, Enter approval, audio playback, Escape discard, and full turn cycle.
</verification>

<success_criteria>
1. Packages/com.google.ai-embodiment/Samples~/QueuedResponseSample/ contains all 5 source files
2. Human verified the complete push-to-talk transcript approval flow in Unity:
   - Hold spacebar records, shows real-time transcript
   - Release spacebar enters review mode
   - Enter plays buffered AI response audio with transcript
   - Escape discards and returns to idle
   - Full cycle repeats for multiple turns
</success_criteria>

<output>
After completion, create `.planning/phases/11.1-queued-response-sample/11.1-02-SUMMARY.md`
</output>
