---
phase: 15.1-audio2animation-pipeline
plan: 01
subsystem: animation
tags: [audio2animation, blendshape, IAnimationModel, fake-model, time-accumulator, plain-csharp]

# Dependency graph
requires:
  - phase: 15-scene-transition-animation
    provides: "BlendshapeAnimationData, BlendshapeAnimationConverter, SyncPacket infrastructure"
provides:
  - "IAnimationModel pluggable interface for audio-to-animation backends"
  - "Audio2Animation orchestrator wiring SyncPacket audio to model frame output"
  - "FakeAnimationModel with time-accumulator budget-driven frame streaming"
  - "Public NormalizeBlendshapeName and FindFuzzyBlendshapeMatch for downstream reuse"
affects: [15.1-02, 16]

# Tech tracking
tech-stack:
  added: []
  patterns:
    - "IAnimationModel interface with SetFrameCallback for pluggable model backends"
    - "Audio-duration budget + time-accumulator Tick() pattern for frame pacing"
    - "Modulo frame index wrapping for looping pre-recorded data"

key-files:
  created:
    - "Packages/com.google.ai-embodiment/Runtime/IAnimationModel.cs"
    - "Packages/com.google.ai-embodiment/Runtime/Audio2Animation.cs"
    - "Packages/com.google.ai-embodiment/Runtime/FakeAnimationModel.cs"
  modified:
    - "Packages/com.google.ai-embodiment/Runtime/BlendshapeAnimationConverter.cs"

key-decisions:
  - "SetFrameCallback on IAnimationModel (not event) for constructor-time wiring from Audio2Animation"
  - "Tick() is NOT part of IAnimationModel interface -- implementation detail of time-based models"
  - "Cancel() does not reset frame index -- next audio continues from where it left off"

patterns-established:
  - "IAnimationModel: pluggable audio-to-animation backend contract"
  - "Audio-duration budget pattern: ProcessAudio accumulates seconds, Tick drains at native FPS"
  - "Plain C# pipeline classes following PacketAssembler convention"

# Metrics
duration: 2min
completed: 2026-02-17
---

# Phase 15.1 Plan 01: Audio2Animation Pipeline Core Summary

**IAnimationModel interface with SetFrameCallback, Audio2Animation SyncPacket orchestrator, and FakeAnimationModel streaming pre-recorded frames via audio-duration budget and time-accumulator Tick()**

## Performance

- **Duration:** 2 min
- **Started:** 2026-02-18T01:11:29Z
- **Completed:** 2026-02-18T01:13:16Z
- **Tasks:** 2
- **Files modified:** 4

## Accomplishments
- IAnimationModel interface with ProcessAudio, Cancel, SetFrameCallback for pluggable model backends
- Audio2Animation orchestrator wires SyncPacket audio to IAnimationModel and exposes OnFrameReady event
- FakeAnimationModel streams pre-recorded BlendshapeFrame data synchronized to audio timing via budget/accumulator
- BlendshapeAnimationConverter fuzzy matching methods made public for downstream FaceAnimationPlayer reuse

## Task Commits

Each task was committed atomically:

1. **Task 1: IAnimationModel interface and Audio2Animation orchestrator** - `32f71c4` (feat)
2. **Task 2: FakeAnimationModel and public fuzzy matching** - `09142bc` (feat)

## Files Created/Modified
- `Packages/com.google.ai-embodiment/Runtime/IAnimationModel.cs` - Pluggable animation model interface (ProcessAudio, Cancel, SetFrameCallback)
- `Packages/com.google.ai-embodiment/Runtime/Audio2Animation.cs` - Orchestrator: SyncPacket audio in, BlendshapeFrame events out
- `Packages/com.google.ai-embodiment/Runtime/FakeAnimationModel.cs` - Pre-recorded JSON frame streaming with audio-duration budget pacing
- `Packages/com.google.ai-embodiment/Runtime/BlendshapeAnimationConverter.cs` - NormalizeBlendshapeName and FindFuzzyBlendshapeMatch changed from private to public

## Decisions Made
- **SetFrameCallback on IAnimationModel:** Chose callback method over event to allow Audio2Animation to wire frame output during construction. The interface owns the contract; Audio2Animation bridges to its OnFrameReady event.
- **Tick() excluded from IAnimationModel:** Tick is an implementation detail of time-based pacing models. A real ML model might emit frames directly from ProcessAudio. Only FakeAnimationModel exposes Tick().
- **Cancel() preserves frame index:** On barge-in, budget and accumulator clear but the frame cursor stays put. Next audio chunk resumes from where playback left off, avoiding jarring jumps to frame 0.

## Deviations from Plan

None - plan executed exactly as written.

## Issues Encountered

None.

## User Setup Required

None - no external service configuration required.

## Next Phase Readiness
- IAnimationModel, Audio2Animation, and FakeAnimationModel are ready for Plan 02 (FaceAnimationPlayer sample MonoBehaviour)
- Public fuzzy matching available for building cached blendshape index maps
- FakeAnimationModel.Tick() ready to be driven by FaceAnimationPlayer.Update()

---
*Phase: 15.1-audio2animation-pipeline*
*Completed: 2026-02-17*
